#######################
# Props for Indexers: #
#######################

# Optional
# Uncomment the TRUNCATE lines

# For Sourcetypes:
# apache:access
# tomcat:access:log
# tomcat:runtime:log
# Use the offical Splunk TA's

# The following sourcetypes rely on Splunk's ability to auto-parse timestamps
# we will optimize this with relevant stanzas in a near future release
# tts:metrics
# tts:pgsql
# assorted small telemetry logs (most of which currently parse as log4j)

[tts:native]
KV_MODE = json
LINE_BREAKER = ([\n\r]+){"ts":
#TRUNCATE = 9999
SHOULD_LINEMERGE = false
TIME_PREFIX = ^{"ts":"
# " closing quote for happier IDEs
MAX_TIMESTAMP_LOOKAHEAD = 30
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3N

[tts:control]
SHOULD_LINEMERGE=false
LINE_BREAKER = ([\n\r]+)\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3}
#TRUNCATE = 99999
TIME_PREFIX = ^
TIME_FORMAT = %Y-%m-%d %H:%M:%S.%3N %z
MAX_TIMESTAMP_LOOKAHEAD = 30

[log4j]
SHOULD_LINEMERGE=false
LINE_BREAKER = ([\n\r]+)\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3}
#TRUNCATE = 99999
TIME_PREFIX = ^
TIME_FORMAT = %Y-%m-%d %H:%M:%S.%3N %z
MAX_TIMESTAMP_LOOKAHEAD = 30

[tts:elastic]
LINE_BREAKER = ([\n\r]+)\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3}
SHOULD_LINEMERGE=false
TIME_PREFIX = ^
TIME_FORMAT = %Y-%m-%d %H:%M:%S,%3N
MAX_TIMESTAMP_LOOKAHEAD = 30

[tts:oauth]
#TRUNCATE = 99999
SHOULD_LINEMERGE=false
LINE_BREAKER=([\r\n]+)
NO_BINARY_CHECK=true
TIME_PREFIX=^[^ ]*
TIME_FORMAT=  %Y-%m-%d %H:%M:%S,%3N %z
MAX_TIMESTAMP_LOOKAHEAD=40

[tts:stdout]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\n\r]+)\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}|([\n\r]+)\[\d+\]\s+\[\w+\]\s+|([\n\r]+)\w{3}\s\d+\,\s\d{4}
#TRUNCATE = 99999
TIME_PREFIX = ^
MAX_TIMESTAMP_LOOKAHEAD = 50

###########################
# Props for Search Heads: #
###########################

[source::*]
REPORT-base_path = base_directory
REPORT-procname2 = processname
REPORT-log_filename = log_filename

[log4j]
EXTRACT-SevJava = (?<SevJava>(INFO|WARN|ERROR|DEBUG|TRACE|FATAL))
EXTRACT-JobEnqueueArgs = args\[\[(?P<jobenqueueargs>[^\]]+)
EXTRACT-arguments = args="\[(?P<jobarguments>[^\]]+)
# " closing quote for happier IDEs
EXTRACT-RequestCompleted = Request Completed: (?P<requesttype>[^ ]+) with status (?P<reqresponse>\d\d\d)
EXTRACT-log4Meta = \((?P<log4meta>[^)]+)

[apache:access]
EXTRACT-VizSession = bootstrapSession/sessions/(?P<VizSession>[0-9A-F]{32}-\d+:\d+)
EXTRACT-sess = .*(?P<sess>[0-9A-F]{32}-\d+:\d+)
EXTRACT-http_status_code = ^(?:[^"]*"){6} (?P<http_status_code>\d{3})
EXTRACT-request_id = ^(?:[^"\n]*"){8}\s+\d+\s+(?P<RequestID>[^\s]+)
EXTRACT-req = ^(?:[^"\n]*"){8}\s+\d+\s+(?P<req>[^\s]+)
EXTRACT-ResponseTime = ^(?:[^"\n]*"){8}\s+(?P<ResponseTime>\d+)
EXTRACT-ApacheWorkbook = /w/(?P<wb>[^/]*)
EXTRACT-ApacheView = /v/(?P<view>[^/]*)

[source::(?::){0}*\\backgrounder*]

[source::(?::){0}*\\dataserver*]

[source::(?::){0}*\\vizqlserver*]

[source::(?::){0}*\\tabproto*]
EXTRACT-ProtoSess = client-session-id":"(?P<sess>[^"]+)
# " closing quote for happier IDEs

[source::(?::){0}*\\vizqlserver]

[source::(?::){0}*logs[^_]dataserver_]
EXTRACT-DSJavaReq = ^(?:[^,\n]*,){3}(?P<req>[^,\)]*),
EXTRACT-DSJavaSess = ^(?:[^,\n]*,){2}(?P<sess>[^,\)]*),

[source::(?::){0}*logs[^_]vizqlserver]
EXTRACT-VQLJavaSess = ^(?:[^,\n]*,){2}(?P<sess>[^,\)]*),

[source::(?::){0}*logs[^_]backgrounder*]
EXTRACT-BGJobID = ^(?:[^,\n]*,){4}(?P<BGJobID>\d+)
EXTRACT-BGJobType = ^(?:[^,\n]*,){5}:(?P<BGJobType>[^,\)]*+)
EXTRACT-BGJobOutcome = Job finished: (?P<BGJobOutcome>[^;]*)
EXTRACT-BGSessID = ^(?:[^,\n]*,){3}(?P<sess>[^,]*),

[source::(?::){0}*logs[^_]backgrounder_]

[source::(?::){0}*logs[^_]vizqlserver_*]
EXTRACT-VQLJavaReq = ^(?:[^,\n]*,){3}(?P<req>[^,\)]*),

[source::(?::){0}*logs[^_]nativeapi_tabadmincontroller*]
EXTRACT-LicenseStateMsg = GetLicenseState\(\): (?P<LicenseStateMsg>[^"]+)
# " closing quote for happier IDEs
EXTRACT-FulfillmentID = FulfillmentId=("?)(?P<FulfillmentID>[^" ,]+)
EXTRACT-CheckoutCode = lc_checkout return information: (?P<CheckoutCode>[^\\]+)

[source::(?::){0}*\\vizportal*]
EXTRACT-VizPortalMeta = \((?P<siteID>[^,]*),(?P<user>[^,]*),(?P<WGSessID>[^,]*),(?P<req>[^,]*),(?P<unknown>[^,]*)\)
EXTRACT-PortalRequestStart = Request received: (?P<RequestMethod>[A-Z]+) for (?P<RequestType>.*)
EXTRACT-PortalRequestEnd = Request completed: (?P<RequestType>[^ ]+) with status (?P<RequestOutcome>\d+)

[source::(?::){0}*logs[^_]tabadminagent*]
EXTRACT-StatusUpdate = Posting status update for (?P<AgentProcStatus>[^,]+)
EXTRACT-AgentDetailMsg = detail message: (?P<AgentDetail>.+)

[tts:pgsql]
EXTRACT-PostgresDuration = duration: (?P<PGSQLduration>[\d\.]+)

[tts:native]
EXTRACT-connectionFilename = filename='(?P<ConnectionFilename>[^']*)

[source::(?::){0}*workgroup.yml]
EXTRACT-workerID = ^worker_id:[\s]+(?P<workerID>.*$)
